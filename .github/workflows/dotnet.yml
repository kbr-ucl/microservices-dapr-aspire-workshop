# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: .NET

on:
  push: 
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses:  actions/checkout@v4
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with: 
        dotnet-version: 9.0.x
    - name: Find and build all solutions
      run: |
        # Find all .slnx and .sln files
        solutions=$(find . -name "*.slnx" -o -name "*.sln")
        
        if [ -z "$solutions" ]; then
          echo "No solution files found"
          exit 1
        fi
        
        # Build each solution
        for solution in $solutions; do
          echo "Building $solution"
          dotnet restore "$solution"
          dotnet build "$solution" --no-restore
        done
    - name: Test
      run: |
        # Find and test all solutions
        solutions=$(find .  -name "*.slnx" -o -name "*.sln")
        for solution in $solutions; do
          echo "Testing $solution"
          dotnet test "$solution" --no-build --verbosity normal || true
        done
